<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRO-PRESS | Professional News Portal</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;700&family=Lora:wght@700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --main-blue: #004a99;
            --dark-blue: #003366;
            --light-bg: #f2f4f7;
            --white: #ffffff;
            --gray-text: #555e67;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Ubuntu', sans-serif; }
        body { background-color: var(--light-bg); color: #1a1a1a; }

        /* HEADER & NAVIGATION */
        header { background: var(--main-blue); color: white; padding: 15px 5%; box-shadow: 0 4px 10px rgba(0,0,0,0.15); position: sticky; top: 0; z-index: 1000; }
        .header-top { display: flex; justify-content: space-between; align-items: center; }
        .logo { font-family: 'Lora', serif; font-size: 2rem; color: white; text-decoration: none; font-weight: bold; }
        
        .nav-cats { display: flex; gap: 20px; margin-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px; overflow-x: auto; }
        .nav-cats a { color: rgba(255,255,255,0.8); text-decoration: none; font-size: 0.9rem; font-weight: bold; white-space: nowrap; }
        .nav-cats a:hover { color: white; }

        /* ADMIN CONTROL BUTTON */
        .admin-trigger { background: var(--dark-blue); color: white; border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; font-size: 0.8rem; }

        /* MAIN CONTAINER */
        .container { max-width: 1100px; margin: 20px auto; display: grid; grid-template-columns: 2fr 1fr; gap: 25px; padding: 0 15px; }

        /* NEWS CARDS */
        .news-list { display: flex; flex-direction: column; gap: 25px; }
        .news-card { background: var(--white); border-radius: 8px; overflow: hidden; box-shadow: 0 2px 15px rgba(0,0,0,0.05); display: flex; flex-direction: column; }
        
        /* RASM JADVALI */
        .img-box { width: 100%; height: 400px; background: #ddd; overflow: hidden; }
        .img-box img { width: 100%; height: 100%; object-fit: cover; transition: 0.3s; }
        .img-box img:hover { transform: scale(1.02); }

        .content-box { padding: 25px; }
        .badge { background: var(--main-blue); color: white; padding: 4px 10px; border-radius: 3px; font-size: 0.75rem; font-weight: bold; margin-bottom: 15px; display: inline-block; }
        .news-card h2 { font-family: 'Lora', serif; font-size: 1.8rem; margin-bottom: 15px; line-height: 1.3; color: #000; }
        .news-card p { color: var(--gray-text); line-height: 1.6; font-size: 1.05rem; margin-bottom: 20px; }

        /* ADMIN PANEL DRAWER */
        #admin-panel { display: none; background: #fff; padding: 25px; border-radius: 8px; margin-bottom: 30px; border: 2px solid var(--main-blue); }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        input, select, textarea { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; outline: none; }
        .btn-send { background: #22c55e; color: white; border: none; padding: 15px; width: 100%; border-radius: 5px; font-weight: bold; cursor: pointer; }

        /* SIDEBAR */
        aside { background: var(--white); padding: 20px; border-radius: 8px; height: fit-content; }
        aside h3 { border-bottom: 2px solid var(--main-blue); padding-bottom: 10px; margin-bottom: 15px; }
        .side-item { padding: 10px 0; border-bottom: 1px solid #eee; font-size: 0.9rem; font-weight: bold; color: #333; cursor: pointer; }

        @media (max-width: 768px) {
            .container { grid-template-columns: 1fr; }
            .img-box { height: 250px; }
        }
    </style>
</head>
<body>

<header>
    <div class="header-top">
        <a href="#" class="logo">PRO-PRESS</a>
        <button class="admin-trigger" onclick="app.checkAdmin()">PANEL ⚙️</button>
    </div>
    <div class="nav-cats">
        <a href="#">BOSH SAHIFA</a>
        <a href="#">SIYOSAT</a>
        <a href="#">IQTISODIYOT</a>
        <a href="#">JAMIYAT</a>
        <a href="#">TEXNOLOGIYA</a>
        <a href="#">SPORT</a>
    </div>
</header>

<div class="container">
    <div class="news-list">
        <div id="admin-panel">
            <h2 style="margin-bottom: 15px;">Yangi nashr yaratish</h2>
            <div class="form-row">
                <input type="text" id="p-title" placeholder="Maqola sarlavhasi">
                <select id="p-cat">
                    <option value="Siyosat">Siyosat</option>
                    <option value="Iqtisodiyot">Iqtisodiyot</option>
                    <option value="Texnologiya">Texnologiya</option>
                    <option value="Sport">Sport</option>
                </select>
            </div>
            <textarea id="p-body" rows="6" placeholder="Batafsil ma'lumot..."></textarea>
            <input type="file" id="p-file" accept="image/*" onchange="app.previewImg(this)">
            <div id="img-feedback"></div>
            <button class="btn-send" onclick="app.publish()">NASHIR QILISH</button>
        </div>

        <div id="feed-box"></div>
    </div>

    <aside>
        <h3>Eng so'nggi xabarlar</h3>
        <div id="side-news"></div>
    </aside>
</div>

<script>
    const API = "https://sheetdb.io/api/v1/9vpxgyb4jfycs";
    const PASS = "1997";

    const app = {
        isMod: false,
        imgData: "",

        checkAdmin: function() {
            const p = prompt("Admin parolini kiriting:");
            if(p === PASS) {
                this.isMod = true;
                document.getElementById('admin-panel').style.display = 'block';
                this.load();
            }
        },

        previewImg: function(input) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.src = e.target.result;
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const w = 1200; // Professional sifat uchun kenglik
                    const h = img.height * (w / img.width);
                    canvas.width = w; canvas.height = h;
                    canvas.getContext('2d').drawImage(img, 0, 0, w, h);
                    this.imgData = canvas.toDataURL('image/jpeg', 0.8);
                    document.getElementById('img-feedback').innerHTML = `<p style="color:green">Rasm tayyor!</p>`;
                }
            };
            reader.readAsDataURL(input.files[0]);
        },

        publish: async function() {
            const t = document.getElementById('p-title').value;
            const b = document.getElementById('p-body').value;
            const c = document.getElementById('p-cat').value;

            if(!t || !b || !this.imgData) return alert("Ma'lumotlar va rasm to'liq emas!");

            const payload = { 
                data: [{ 
                    id: Date.now(), 
                    title: t, 
                    body: b, 
                    category: c,
                    image: this.imgData, 
                    date: new Date().toLocaleDateString('uz-UZ') 
                }] 
            };

            await fetch(API, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(payload)
            });

            location.reload();
        },

        load: async function() {
            const res = await fetch(API);
            const data = await res.json();
            const feed = document.getElementById('feed-box');
            const side = document.getElementById('side-news');

            const newsHtml = data.reverse().map(p => `
                <div class="news-card">
                    <div class="img-box">
                        <img src="${p.image}" alt="rasm" onerror="this.src='https://via.placeholder.com/800x400?text=Rasm+Yuklanmadi'">
                    </div>
                    <div class="content-box">
                        <span class="badge">${p.category || 'Yangiliklar'}</span>
                        <span style="font-size:0.8rem; color:#999"> | ${p.date}</span>
                        <h2>${p.title}</h2>
                        <p>${p.body}</p>
                        ${this.isMod ? `<button onclick="app.del('${p.id}')" style="color:red; cursor:pointer; border:none; background:none; font-weight:bold;">O'CHIRISH</button>` : ''}
                    </div>
                </div>
            `).join('');

            feed.innerHTML = newsHtml;
            side.innerHTML = data.slice(0,5).map(p => `<div class="side-item">${p.title.substring(0, 50)}...</div>`).join('');
        },

        del: async function(id) {
            if(confirm("Ushbu xabarni o'chirasizmi?")) {
                await fetch(`${API}/id/${id}`, { method: 'DELETE' });
                location.reload();
            }
        }
    };

    window.onload = () => app.load();
</script>

</body>
</html>
