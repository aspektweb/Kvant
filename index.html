<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Portfolio & Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background-color: #000; color: #fff; font-family: 'Inter', sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .admin-panel { display: none; } /* Admin panel yashirin */
    </style>
</head>
<body class="p-6">

    <header class="max-w-5xl mx-auto flex justify-between items-center mb-12 border-b border-zinc-800 pb-6">
        <h1 class="text-xl font-bold tracking-widest">ARCHIVE.UZ</h1>
        <button onclick="toggleAdmin()" class="opacity-10 hover:opacity-100 transition text-xs border border-zinc-700 px-3 py-1 rounded">Admin</button>
    </header>

    <div id="adminArea" class="admin-panel max-w-5xl mx-auto mb-16 p-8 glass rounded-3xl">
        <h2 class="text-2xl font-bold mb-6 text-blue-400 text-center">Yangi Resurs Qo'shish</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <input type="text" id="title" placeholder="Sarlavha" class="bg-zinc-900 p-3 rounded-xl border border-zinc-700 outline-none focus:border-blue-500">
            <input type="text" id="link" placeholder="Havola (URL)" class="bg-zinc-900 p-3 rounded-xl border border-zinc-700 outline-none focus:border-blue-500">
            <input type="text" id="image" placeholder="Rasm URL manzili" class="bg-zinc-900 p-3 rounded-xl border border-zinc-700 outline-none focus:border-blue-500">
            <input type="text" id="category" placeholder="Kategoriya" class="bg-zinc-900 p-3 rounded-xl border border-zinc-700 outline-none focus:border-blue-500">
            <textarea id="desc" placeholder="Qisqacha tavsif" class="bg-zinc-900 p-3 rounded-xl border border-zinc-700 md:col-span-2 h-24"></textarea>
            <button onclick="addItem()" id="addBtn" class="md:col-span-2 bg-blue-600 hover:bg-blue-700 py-3 rounded-xl font-bold transition">SAQLASH</button>
        </div>
    </div>

    <main id="portfolio-grid" class="max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-8">
        <div class="text-zinc-600 animate-pulse">Ma'lumotlar yuklanmoqda...</div>
    </main>

    <script>
        const API_URL = 'https://sheetdb.io/api/v1/9vpxgyb4jfycs';
        let isAdmin = false;

        // Admin panelni ochish/yopish (Maxfiy tugma orqali)
        function toggleAdmin() {
            const password = prompt("Admin parolini kiriting:");
            if (password === "1234") { // Parolni xohlaganingga o'zgartir
                isAdmin = !isAdmin;
                document.getElementById('adminArea').style.display = isAdmin ? 'block' : 'none';
                loadItems(); // O'chirish tugmalari ko'rinishi uchun qayta yuklash
            } else {
                alert("Parol noto'g'ri!");
            }
        }

        // Ma'lumotlarni yuklash
        async function loadItems() {
            try {
                const res = await fetch(API_URL);
                const data = await res.json();
                const grid = document.getElementById('portfolio-grid');
                grid.innerHTML = '';

                data.reverse().forEach(item => {
                    grid.innerHTML += `
                        <div class="glass rounded-3xl overflow-hidden group relative">
                            <img src="${item.image}" class="w-full h-52 object-cover opacity-70 group-hover:opacity-100 transition duration-500">
                            <div class="p-6">
                                <span class="text-[10px] text-blue-500 uppercase font-bold tracking-widest">${item.category || 'Resurs'}</span>
                                <h3 class="text-xl font-bold my-2">${item.title}</h3>
                                <p class="text-zinc-500 text-sm mb-6">${item.description}</p>
                                <div class="flex justify-between items-center">
                                    <a href="${item.link}" target="_blank" class="text-sm font-bold border-b border-blue-500 pb-1">KO'RISH</a>
                                    ${isAdmin ? `<button onclick="deleteItem('${item.title}')" class="text-red-500 text-xs font-bold hover:underline">O'CHIRISH</button>` : ''}
                                </div>
                            </div>
                        </div>
                    `;
                });
            } catch (e) { console.error("Xato:", e); }
        }

        // Yangi narsa qo'shish
        async function addItem() {
            const addBtn = document.getElementById('addBtn');
            addBtn.innerText = "Yuborilmoqda...";
            addBtn.disabled = true;

            const newItem = {
                data: [{
                    title: document.getElementById('title').value,
                    description: document.getElementById('desc').value,
                    link: document.getElementById('link').value,
                    image: document.getElementById('image').value,
                    category: document.getElementById('category').value
                }]
            };

            const res = await fetch(API_URL, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(newItem)
            });

            if(res.ok) {
                alert("Muvaffaqiyatli qo'shildi!");
                location.reload();
            }
            addBtn.innerText = "SAQLASH";
            addBtn.disabled = false;
        }

        // O'chirish funksiyasi
        async function deleteItem(title) {
            if(!confirm(`'${title}' ni o'chirib tashlamoqchimisiz?`)) return;

            const res = await fetch(`${API_URL}/title/${encodeURIComponent(title)}`, {
                method: 'DELETE'
            });

            if(res.ok) {
                alert("O'chirildi!");
                loadItems();
            }
        }

        loadItems();
    </script>
</body>
</html>
