<!doctype html>
<html lang="uz">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Restaurant App — Auth Demo</title>
  <style>
    body{font-family:Inter,system-ui,Arial;background:#07121a;color:#e6f7ff;display:flex;align-items:center;justify-content:center;height:100vh;margin:0}
    .card{width:360px;padding:18px;border-radius:12px;background:rgba(255,255,255,0.03)}
    input,button{width:100%;padding:10px;margin-top:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit}
    .row{display:flex;gap:8px}
    .row input{flex:1}
    .muted{opacity:0.8;font-size:13px;margin-top:8px}
  </style>
</head>
<body>
  <div class="card">
    <h2>Ro'yxatdan o'tish / Login</h2>

    <input id="email" placeholder="Email" type="email" />
    <input id="password" placeholder="Parol" type="password" />
    <button id="btnSignup">Ro'yxatdan o'tish</button>
    <button id="btnLogin">Kirish</button>
    <button id="btnLogout" style="display:none">Chiqish</button>

    <div class="muted" id="status">Holat: not signed in</div>
    <hr/>
    <div>
      <strong>Test uchun:</strong>
      <div class="muted">Qayd: bu demo faqat authentification & profile yozadi. Administratorga email yuborish Cloud Function orqali amalga oshiriladi.</div>
    </div>
  </div>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-firestore-compat.js"></script>

  <script>
    // --- 1) PUT YOUR FIREBASE CONFIG HERE ---
    const firebaseConfig = {
      apiKey: "REPLACE_API_KEY",
      authDomain: "REPLACE_PROJECT.firebaseapp.com",
      projectId: "REPLACE_PROJECT",
      storageBucket: "REPLACE_PROJECT.appspot.com",
      messagingSenderId: "REPLACE_ID",
      appId: "REPLACE_APPID"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const emailEl = document.getElementById('email');
    const passEl = document.getElementById('password');
    const btnSignup = document.getElementById('btnSignup');
    const btnLogin = document.getElementById('btnLogin');
    const btnLogout = document.getElementById('btnLogout');
    const status = document.getElementById('status');

    btnSignup.addEventListener('click', async () => {
      const email = emailEl.value.trim();
      const password = passEl.value;
      if(!email || !password){ alert('Email va parol kiriting'); return; }
      try{
        const cred = await auth.createUserWithEmailAndPassword(email, password);
        const user = cred.user;
        // Save extra profile to Firestore (this will also be available for Cloud Function)
        await db.collection('users').doc(user.uid).set({
          email: user.email,
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          displayName: null,
          verified: user.emailVerified || false
        });
        alert('Ro‘yxatdan o‘tildi. Confirm function will send notification if configured.');
      }catch(e){ alert('Signup error: '+e.message) }
    });

    btnLogin.addEventListener('click', async () => {
      const email = emailEl.value.trim();
      const password = passEl.value;
      try{
        await auth.signInWithEmailAndPassword(email, password);
      }catch(e){ alert('Login error: '+e.message) }
    });

    btnLogout.addEventListener('click', async () => {
      await auth.signOut();
    });

    auth.onAuthStateChanged(async (user) => {
      if(user){
        status.innerText = 'Holat: signed in as ' + user.email;
        btnLogout.style.display = 'block';
        btnLogin.style.display = 'none';
        btnSignup.style.display = 'none';
        // Optionally fetch profile
        const doc = await db.collection('users').doc(user.uid).get();
        // you can show profile fields if needed
      } else {
        status.innerText = 'Holat: not signed in';
        btnLogout.style.display = 'none';
        btnLogin.style.display = 'block';
        btnSignup.style.display = 'block';
      }
    });
  </script>
</body>
</html>