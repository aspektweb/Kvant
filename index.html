<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon Cloud Press</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Exo+2&display=swap" rel="stylesheet">
    <style>
        :root { --neon: #00f2ff; --pink: #ff00ff; --bg: #020205; }
        * { box-sizing: border-box; }
        body { background: var(--bg); color: #fff; font-family: 'Exo 2', sans-serif; margin: 0; padding: 20px; }
        
        /* Design Elements */
        .container { max-width: 600px; margin: 0 auto; }
        .header { font-family: 'Orbitron'; color: var(--neon); text-align: center; text-shadow: 0 0 10px var(--neon); margin-bottom: 30px; }
        
        .card { background: rgba(255,255,255,0.03); border: 1px solid var(--neon); padding: 20px; border-radius: 10px; margin-bottom: 25px; box-shadow: 0 0 15px rgba(0,242,255,0.1); }
        
        input, textarea { width: 100%; padding: 12px; margin: 10px 0; background: #000; border: 1px solid #333; color: #fff; border-radius: 5px; outline: none; transition: 0.3s; }
        input:focus { border-color: var(--neon); box-shadow: 0 0 10px var(--neon); }
        
        .btn { width: 100%; padding: 15px; background: var(--neon); border: none; font-family: 'Orbitron'; font-weight: bold; cursor: pointer; transition: 0.3s; margin-top: 10px; }
        .btn:hover { background: #fff; box-shadow: 0 0 20px var(--neon); }
        .btn:disabled { background: #444; cursor: not-allowed; }

        /* Post Display */
        .post { background: #08080a; border-left: 4px solid var(--pink); padding: 15px; margin-bottom: 20px; animation: slideIn 0.5s ease; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .post h3 { margin: 0; color: var(--neon); font-family: 'Orbitron'; font-size: 1.1rem; }
        .post p { line-height: 1.6; white-space: pre-wrap; color: #ccc; }
        .post img { width: 100%; border-radius: 5px; margin-top: 10px; border: 1px solid #222; }
        
        #status { text-align: center; font-size: 0.8rem; color: var(--pink); margin-bottom: 10px; display: none; }
        #preview-img { width: 100%; height: 150px; border: 1px dashed #333; margin: 10px 0; display: flex; align-items:center; justify-content:center; overflow:hidden; }
        #preview-img img { width: 100%; height: 100%; object-fit: cover; }
    </style>
</head>
<body>

<div class="container">
    <h1 class="header">NEON DATABASE</h1>

    <div class="card">
        <h3 style="margin-top:0; font-size:0.9rem; color:var(--pink)">[ YANGI MATERIYAL ]</h3>
        <input type="text" id="title" placeholder="Sarlavha...">
        <textarea id="body" rows="4" placeholder="Maqola matni..."></textarea>
        
        <label style="font-size: 12px; color: var(--neon);">RASM YUKLASH:</label>
        <input type="file" id="file" accept="image/*" onchange="app.preview(this)">
        <div id="preview-img"><small style="color:#444">Rasm tanlanmagan</small></div>
        
        <div id="status">Baza yangilanmoqda...</div>
        <button class="btn" id="saveBtn" onclick="app.save()">BULUTGA SAQLASH</button>
    </div>

    <h2 style="font-family:'Orbitron'; font-size:1.2rem; border-bottom:1px solid #222; padding-bottom:10px;">ARXIV</h2>
    <div id="feed">Yuklanmoqda...</div>
</div>

<script>
    // Siz yaratgan SheetDB API havolasi
    const DATABASE_URL = "https://sheetdb.io/api/v1/9vpxgyb4jfycs";

    const app = {
        base64Image: "",

        // Rasmni preview qilish va siqish
        preview: function(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        const maxW = 500;
                        const scale = maxW / img.width;
                        canvas.width = maxW;
                        canvas.height = img.height * scale;
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        this.base64Image = canvas.toDataURL('image/jpeg', 0.6);
                        document.getElementById('preview-img').innerHTML = `<img src="${this.base64Image}">`;
                    };
                };
                reader.readAsDataURL(input.files[0]);
            }
        },

        // Ma'lumotni Google Sheetsga yuborish
        save: async function() {
            const t = document.getElementById('title').value;
            const b = document.getElementById('body').value;
            if(!t || !b) return alert("Sarlavha va matnni yozing!");

            const btn = document.getElementById('saveBtn');
            const status = document.getElementById('status');
            
            btn.disabled = true;
            status.style.display = 'block';

            // SheetDB formatida ma'lumot tuzilmasi
            const payload = {
                data: [{
                    id: new Date().toLocaleString(),
                    title: t,
                    body: b,
                    image: this.base64Image
                }]
            };

            try {
                const response = await fetch(DATABASE_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if(response.ok) {
                    alert("Ma'lumot bazaga muvaffaqiyatli qo'shildi!");
                    location.reload();
                }
            } catch (error) {
                alert("Xatolik yuz berdi. Internetni tekshiring.");
                btn.disabled = false;
                status.style.display = 'none';
            }
        },

        // Ma'lumotlarni bazadan o'qib olish
        load: async function() {
            const feed = document.getElementById('feed');
            try {
                const res = await fetch(DATABASE_URL);
                const data = await res.json();
                
                if(data.length === 0) {
                    feed.innerHTML = "Hozircha bazada ma'lumot yo'q.";
                    return;
                }

                feed.innerHTML = data.reverse().map(item => `
                    <div class="post">
                        <h3>${item.title}</h3>
                        <small style="color:#444; font-size:10px;">${item.id}</small>
                        ${item.image ? `<img src="${item.image}">` : ''}
                        <p>${item.body}</p>
                    </div>
                `).join('');
            } catch (error) {
                feed.innerHTML = "Bazaga ulanishda xatolik yuz berdi.";
            }
        }
    };

    // Sahifa yuklanganda ma'lumotlarni olib kelish
    app.load();
</script>

</body>
</html>
